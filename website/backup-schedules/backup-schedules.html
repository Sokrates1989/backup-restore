<!-- Backup Schedules Tab -->
<div id="backup-schedules-tab" class="tab-content hidden">
    <div class="card">
        <div class="card-header">
            <h2>Backup Schedules</h2>
            <div class="header-actions">
                <button id="run-enabled-schedules-btn" class="btn btn-primary btn-sm" title="Run all enabled schedules immediately">Run All Now</button>
                <button id="add-backup-schedule-btn" class="btn btn-secondary btn-sm">+ Add Backup Schedule</button>
            </div>
        </div>
        <p class="hint">When and how often to run backups from databases to remote storage locations</p>
        <div id="backup-schedules-list" class="items-list">
            <p class="loading">Loading backup schedules...</p>
        </div>
    </div>

    <!-- Add/Edit Backup Schedule Form -->
    <div id="backup-schedule-form" class="card hidden">
        <div class="form-header">
            <h2 id="backup-schedule-form-title">Add Backup Schedule</h2>
            <button type="button" id="backup-schedule-form-close-btn" class="modal-close" aria-label="Close">√ó</button>
        </div>
        <input type="hidden" id="backup-schedule-id">
        
        <!-- Basic Settings -->
        <div class="form-section">
            <h3>Basic Settings</h3>
            <div class="form-group">
                <label for="backup-schedule-name">Name</label>
                <input type="text" id="backup-schedule-name" placeholder="e.g., Daily Production Backup">
            </div>
            <div class="form-group">
                <label for="backup-schedule-database">Database</label>
                <select id="backup-schedule-database">
                    <option value="">Select a database...</option>
                </select>
            </div>
            <div class="form-group">
                <label>Storage Locations (select one or more)</label>
                <div id="backup-schedule-destinations" class="checkbox-group">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="form-group">
                <label for="backup-schedule-interval">Backup Interval</label>
                <select id="backup-schedule-interval">
                    <option value="3600">Hourly</option>
                    <option value="21600">Every 6 Hours</option>
                    <option value="43200">Every 12 Hours</option>
                    <option value="86400" selected>Daily</option>
                    <option value="604800">Weekly</option>
                    <option value="2592000">Monthly</option>
                </select>
            </div>

            <div id="backup-schedule-daily-time-group" class="form-group">
                <label for="backup-schedule-daily-time">Run Time (UTC)</label>
                <input type="time" id="backup-schedule-daily-time" value="">
                <p id="backup-schedule-daily-time-hint" class="hint">Anchor time for the schedule. For Daily, default: 03:30.</p>
            </div>
            <div class="form-group inline-checkbox">
                <input type="checkbox" id="backup-schedule-enabled" checked>
                <label for="backup-schedule-enabled">Enabled</label>
            </div>
        </div>

        <!-- Encryption Settings -->
        <div class="form-section">
            <h3>Encryption (Optional)</h3>
            <p class="hint">Encrypt backups with a password for additional security</p>
            <div class="form-group inline-checkbox">
                <input type="checkbox" id="backup-schedule-encrypt">
                <label for="backup-schedule-encrypt">Enable backup encryption</label>
            </div>
            <div id="backup-schedule-encrypt-options" class="hidden">
                <div class="form-group">
                    <label for="backup-schedule-encrypt-password">Encryption Password</label>
                    <input type="password" id="backup-schedule-encrypt-password" placeholder="Enter encryption password">
                    <p class="hint warning">‚ö†Ô∏è Store this password safely! You cannot restore without it.</p>
                </div>
            </div>
        </div>

        <!-- Retention Policy -->
        <div class="form-section">
            <h3>Retention Policy</h3>
            <p class="hint">Control how many backups to keep and storage limits</p>
            <div class="form-group">
                <label for="backup-schedule-retention-type">Retention Type</label>
                <select id="backup-schedule-retention-type">
                    <option value="count">Keep N backups</option>
                    <option value="days">Keep backups for N days</option>
                    <option value="size">Limit total storage size</option>
                    <option value="smart">Smart Retention (Recommended)</option>
                </select>
            </div>
            <div id="retention-count-options">
                <div class="form-group">
                    <label for="backup-schedule-retention-count">Number of Backups to Keep</label>
                    <input type="number" id="backup-schedule-retention-count" value="7" min="1" max="365">
                </div>
            </div>
            <div id="retention-days-options" class="hidden">
                <div class="form-group">
                    <label for="backup-schedule-retention-days">Days to Keep Backups</label>
                    <input type="number" id="backup-schedule-retention-days" value="30" min="1" max="3650">
                </div>
            </div>
            <div id="retention-size-options" class="hidden">
                <div class="form-group">
                    <label for="backup-schedule-retention-size">Maximum Storage (MB)</label>
                    <input type="number" id="backup-schedule-retention-size" value="1000" min="100">
                </div>
            </div>
            <div id="retention-smart-options" class="hidden">
                <div class="warning-box">
                    <strong>üõ°Ô∏è Smart Retention - Protection Against Late-Detected Corruption</strong>
                    <p>Keeps older backups in a tiered manner to protect against ransomware or corruption detected after regular backups have been overwritten.</p>
                </div>
                <div class="form-group">
                    <label for="backup-schedule-smart-daily">Daily backups to keep</label>
                    <input type="number" id="backup-schedule-smart-daily" value="7" min="1" max="30">
                    <p class="hint">Keep the last N daily backups</p>
                </div>
                <div class="form-group">
                    <label for="backup-schedule-smart-weekly">Weekly backups to keep</label>
                    <input type="number" id="backup-schedule-smart-weekly" value="4" min="0" max="52">
                    <p class="hint">Keep one backup per week for the last N weeks</p>
                </div>
                <div class="form-group">
                    <label for="backup-schedule-smart-monthly">Monthly backups to keep</label>
                    <input type="number" id="backup-schedule-smart-monthly" value="6" min="0" max="24">
                    <p class="hint">Keep one backup per month for the last N months</p>
                </div>
                <div class="form-group">
                    <label for="backup-schedule-smart-yearly">Yearly backups to keep</label>
                    <input type="number" id="backup-schedule-smart-yearly" value="2" min="0" max="10">
                    <p class="hint">Keep one backup per year for the last N years</p>
                </div>
                <p class="hint">Note: Smart retention keeps older backups on purpose. From time to time you may want to manually review and delete older backups to save space.</p>
            </div>
        </div>

        <!-- Notification Settings -->
        <div class="form-section">
            <h3>Notifications</h3>
            <p class="hint">Get notified about backup status via Telegram or Email</p>
            
            <div class="form-group inline-checkbox">
                <input type="checkbox" id="backup-schedule-notify-telegram">
                <label for="backup-schedule-notify-telegram">Enable Telegram notifications</label>
            </div>
            <div id="backup-schedule-telegram-options" class="hidden">
                <div class="form-group">
                    <label>Telegram Recipients</label>
                    <div id="backup-schedule-telegram-recipients"></div>
                    <button type="button" id="backup-schedule-add-telegram-recipient" class="btn btn-secondary btn-sm">+ Add Telegram Chat</button>
                    <p class="hint">Add one or more Telegram chat IDs. <a href="https://wiki.fe-wi.com/en/public/new-telegram-bot">How to setup telegram bot</a>. Set the minimum severity per recipient.</p>
                </div>
                <div class="form-group inline-checkbox">
                    <input type="checkbox" id="backup-schedule-telegram-attach">
                    <label for="backup-schedule-telegram-attach">Attach backup file to Telegram (may be large)</label>
                </div>
                <div class="form-group">
                    <label for="backup-schedule-telegram-attach-max">Telegram attachment max size (MB)</label>
                    <input type="number" id="backup-schedule-telegram-attach-max" min="1" step="1" value="50">
                    <p class="hint">Defaults to Telegram's 50 MB limit unless overridden.</p>
                </div>
            </div>

            <div class="form-group inline-checkbox">
                <input type="checkbox" id="backup-schedule-notify-email">
                <label for="backup-schedule-notify-email">Enable Email notifications</label>
            </div>
            <div id="backup-schedule-email-options" class="hidden">
                <div class="form-group">
                    <label>Email Recipients</label>
                    <div id="backup-schedule-email-recipients"></div>
                    <button type="button" id="backup-schedule-add-email-recipient" class="btn btn-secondary btn-sm">+ Add Email Address</button>
                    <p class="hint">Add one or more email recipients. Set the minimum severity per recipient.</p>
                </div>
                <div class="form-group inline-checkbox">
                    <input type="checkbox" id="backup-schedule-email-attach">
                    <label for="backup-schedule-email-attach">Attach backup file to Email (may be large)</label>
                </div>
                <div class="form-group">
                    <label for="backup-schedule-email-attach-max">Email attachment max size (MB)</label>
                    <input type="number" id="backup-schedule-email-attach-max" min="1" step="1" value="10">
                    <p class="hint">Defaults to 10 MB unless overridden.</p>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button id="save-backup-schedule-btn" class="btn btn-primary">Save Backup Schedule</button>
            <button id="cancel-backup-schedule-btn" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>
